<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AxPlugin Capacitor - Exemplo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .container {
            background-color: #f5f5f5;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #speed-display {
            font-size: 48px;
            font-weight: bold;
            color: #007bff;
            text-align: center;
            margin: 30px 0;
        }
        #status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status-success {
            background-color: #d4edda;
            color: #155724;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .status-info {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        #log {
            background-color: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AxPlugin Capacitor - Teste de Velocidade</h1>

        <div id="status" class="status-info">
            Status: Aguardando configuração...
        </div>

        <div>
            <label for="apiKey">API Key:</label>
            <input type="text" id="apiKey" value="test-api-key-123" style="width: 300px; padding: 8px;">
        </div>

        <div style="margin-top: 20px;">
            <button id="setupBtn" onclick="setupPlugin()">1. Setup</button>
            <button id="startBtn" onclick="startTest()" disabled>2. Iniciar Teste</button>
            <button id="stopBtn" onclick="stopTest()" disabled>3. Parar Teste</button>
            <button id="checkBtn" onclick="checkAvailability()">Verificar Disponibilidade</button>
        </div>

        <div id="speed-display">
            -- Mbps
        </div>

        <h3>Log de Eventos:</h3>
        <div id="log"></div>
    </div>

    <script type="module">
        import { AxPlugin } from './dist/esm/index.js';

        window.AxPlugin = AxPlugin;
        let isConfigured = false;
        let isRunning = false;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : '#fff';
            logDiv.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = `Status: ${message}`;
            statusDiv.className = `status-${type}`;
        }

        function updateSpeed(value) {
            document.getElementById('speed-display').textContent = `${value} Mbps`;
        }

        window.setupPlugin = async function() {
            const apiKey = document.getElementById('apiKey').value;

            if (!apiKey) {
                updateStatus('Por favor, insira uma API Key', 'error');
                log('Erro: API Key vazia', 'error');
                return;
            }

            try {
                log('Configurando plugin...');
                const result = await AxPlugin.setup({ apiKey });
                log(`✓ ${result.message}`, 'success');
                updateStatus('Plugin configurado com sucesso', 'success');
                isConfigured = true;

                // Habilitar botão de start
                document.getElementById('startBtn').disabled = false;
            } catch (error) {
                log(`✗ Erro no setup: ${error}`, 'error');
                updateStatus('Erro na configuração', 'error');
            }
        };

        window.startTest = async function() {
            if (!isConfigured) {
                updateStatus('Configure o plugin primeiro', 'error');
                return;
            }

            try {
                log('Registrando listeners...');

                // Registrar listener para atualizações de velocidade
                await AxPlugin.addListener('onSpeedUpdate', (data) => {
                    log(`Velocidade atualizada: ${data.value} Mbps`);
                    updateSpeed(data.value);
                });

                // Registrar listener para erros
                await AxPlugin.addListener('onError', (data) => {
                    log(`✗ Erro: ${data.error}`, 'error');
                    updateStatus('Erro durante o teste', 'error');
                });

                log('Iniciando teste...');
                await AxPlugin.start();
                log('✓ Teste iniciado', 'success');
                updateStatus('Teste em andamento...', 'success');
                isRunning = true;

                // Atualizar botões
                document.getElementById('startBtn').disabled = true;
                document.getElementById('stopBtn').disabled = false;
            } catch (error) {
                log(`✗ Erro ao iniciar: ${error}`, 'error');
                updateStatus('Erro ao iniciar teste', 'error');
            }
        };

        window.stopTest = async function() {
            try {
                log('Parando teste...');
                const result = await AxPlugin.stop();
                log(`✓ ${result.message}`, 'success');
                updateStatus('Teste parado', 'info');
                isRunning = false;

                // Remover listeners
                await AxPlugin.removeAllListeners();
                log('✓ Listeners removidos', 'success');

                // Atualizar botões
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;

                // Resetar display
                updateSpeed('--');
            } catch (error) {
                log(`✗ Erro ao parar: ${error}`, 'error');
                updateStatus('Erro ao parar teste', 'error');
            }
        };

        window.checkAvailability = async function() {
            try {
                log('Verificando disponibilidade...');
                const { available } = await AxPlugin.isAvailable();
                log(`✓ Plugin disponível: ${available}`, available ? 'success' : 'error');

                if (available) {
                    updateStatus('Plugin disponível nesta plataforma', 'success');
                } else {
                    updateStatus('Plugin não disponível (requer Android)', 'error');
                }
            } catch (error) {
                log(`✗ Erro ao verificar: ${error}`, 'error');
                updateStatus('Erro ao verificar disponibilidade', 'error');
            }
        };

        // Auto-verificar disponibilidade ao carregar
        window.addEventListener('load', () => {
            log('Página carregada');
            checkAvailability();
        });
    </script>
</body>
</html>
